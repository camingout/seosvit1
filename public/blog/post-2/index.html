<!doctype html><html lang=uk><head><meta charset=utf-8><title>Налаштування E-commerce Google Analytics на OpenCart 3.x</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Налаштування E-commerce Google Analytics на OpenCart 3.x"><meta name=author content="Themefisher"><meta name=generator content="Hugo 0.74.3"><link rel=stylesheet href=/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=/plugins/slick/slick.css><link rel=stylesheet href=/plugins/themify-icons/themify-icons.css><link rel=stylesheet href=/css/custom.css><link rel=stylesheet href=/scss/style.min.css media=screen><script data-ad-client=ca-pub-4898510992654911 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><link rel="shortcut icon" href=/images/favicon.png type=image/x-icon><link rel=icon href=/images/favicon.png type=image/x-icon></head><body><header class="sticky-top navigation"><div class=container><nav class="navbar navbar-expand-lg navbar-light"><a class=navbar-brand href=/><img class=img-fluid src=/images/logo.png alt="SEO просування сайту | Розкрутка сайтів в Україні"></a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class=ti-menu></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav mx-auto"><li class=nav-item><a class=nav-link href=/>Домів</a></li><li class=nav-item><a class=nav-link href=/products/>Послуги</a></li><li class=nav-item><a class=nav-link href=/blog/>Блог</a></li><li class=nav-item><a class=nav-link href=/faq/>FAQ</a></li><li class=nav-item><a class=nav-link href=/contact/>Контакти</a></li></ul></div></nav></div></header><section class="section pt-0"><div class=container><div class=row><div class="col-lg-8 mx-auto"><article><h2>Налаштування E-commerce Google Analytics на OpenCart 3.x</h2><ul class="list-inline mb-4"><li class=list-inline-item><i class="ti-pencil-alt text-primary mr-2"></i>By Yurii</li><li class=list-inline-item><i class="ti-calendar text-primary mr-2"></i>04 Apr, 2022</li></ul><img src=/images/blog/post-21.jpg alt="Налаштування E-commerce Google Analytics на OpenCart 3.x" class="img-fluid w-100 mb-4"><div class=content><p>Привіт, інтернет-магазини на платформі Opencart дозволяють швидко розгорнути проект та протестити нішу. Для цього достатньо недорогого шаред-хостингу, який підтримує php5-7 та бази даних SQL. Зазвичай заливають товари від поставщика та запускають Google shopping. Щоб система ефективно працювала необхідно налаштувати відстеження транзакцій та відправку їх до Google Analytics та Google Ads. Звісно є готові модулі, які в кілька кліків дозволяють налаштувати відстеження по повному пансіону. Проте я вам покажу як мінімальними зусиллями налаштувати розширену торгівлю своїми руками.</p><h3 id=формування-даних-для-відстеження-транзакцій>Формування даних для відстеження транзакцій</h3><p>Формування масиву даних для відстеження транзакцій я продемострую на базі Brocart Version 3.0.3.6 (bro) з використанням gtag. Для ефективної роботи ремендую одразу встановити Modification Manager, це модуль який дозволяє додавати та вносити правки в плагін.</p><p>Перш за все ви маєте встановити код аналітики gtag, який ви знайдете в кабінеті <a href=https://analytics.google.com>https://analytics.google.com</a>, та увімкнути розширену електронну торгівлю в налаштуваннях представлення. Наступним кроком буде формування модифікатора.</p><p>Правки ми будемо вносити до файлів catalog/controller/checkout/success.php та catalog/view/theme/*/template/common/success.twig. В першому ми отримаємо із поточної сесії дані про транзакцію та товари, які були додані до кошика, а в другому люб&rsquo;язно віддамо ці дані в аналітику.</p><blockquote><p>Щоб стати програмістом не обов&rsquo;язково ставати програмістом</p></blockquote><p>Щоб зібрати модифікатор нам необхідно мати заготовку, звичайно ви можете скопіювати з якогось іншого модифікатора і внести в нього правки, але я спрощу вам задачу.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>xml</span> <span style=color:#a6e22e>version</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;1.0&#34;</span> <span style=color:#a6e22e>encoding</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTF-8&#34;</span><span style=color:#f92672>?&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>modification</span><span style=color:#f92672>&gt;</span>
<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>name</span><span style=color:#f92672>&gt;&lt;!</span>[<span style=color:#a6e22e>CDATA</span>[<span style=color:#a6e22e>OpenCart</span> <span style=color:#a6e22e>Google</span> <span style=color:#a6e22e>Enhanced</span> <span style=color:#a6e22e>Ecommerce</span>]]<span style=color:#f92672>&gt;&lt;</span><span style=color:#960050;background-color:#1e0010>/name&gt;</span>
     <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>code</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>enhanced_ecommerce_plugin</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/code&gt;</span>
     <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>version</span><span style=color:#f92672>&gt;</span><span style=color:#ae81ff>1.0</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/version&gt;</span>
     <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>author</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>Nuub</span><span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/author&gt;   </span>
     <span style=color:#f92672>&lt;</span><span style=color:#a6e22e>link</span><span style=color:#f92672>&gt;</span><span style=color:#a6e22e>https</span><span style=color:#f92672>:</span><span style=color:#75715e>//seosvit.com.ua&lt;/link&gt; 
</span><span style=color:#75715e></span>
     <span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/modification&gt;</span>
</code></pre></div><p>Тепер ми маємо отримати дані про транзакцію та підготувати масив даних про товарі, які додані до кошика.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript>  	<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>file</span> <span style=color:#a6e22e>path</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;catalog/controller/checkout/success.php&#34;</span><span style=color:#f92672>&gt;</span>
		<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>operation</span><span style=color:#f92672>&gt;</span>
			<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>search</span> <span style=color:#a6e22e>trim</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#f92672>&gt;&lt;!</span>[<span style=color:#a6e22e>CDATA</span>[<span style=color:#a6e22e>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>cart</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>clear</span>();]]<span style=color:#f92672>&gt;&lt;</span><span style=color:#960050;background-color:#1e0010>/search&gt;</span>
			<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>add</span> <span style=color:#a6e22e>position</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;before&#34;</span><span style=color:#f92672>&gt;&lt;!</span>[<span style=color:#a6e22e>CDATA</span>[
				<span style=color:#a6e22e>$data</span>[<span style=color:#e6db74>&#39;order_id&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>session</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>data</span>[<span style=color:#e6db74>&#39;order_id&#39;</span>];
				<span style=color:#a6e22e>$data</span>[<span style=color:#e6db74>&#39;total&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>cart</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getTotal</span>();
				<span style=color:#a6e22e>$products</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>cart</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>getProducts</span>();
				<span style=color:#a6e22e>$my_feeds</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>array</span>();
				<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>$products</span>) {
					<span style=color:#a6e22e>foreach</span> (<span style=color:#a6e22e>$products</span> <span style=color:#a6e22e>as</span> <span style=color:#a6e22e>$product</span>) {
						<span style=color:#a6e22e>$my_feeds</span>[] <span style=color:#f92672>=</span> <span style=color:#a6e22e>array</span>(
							<span style=color:#e6db74>&#39;name&#39;</span> =&gt; <span style=color:#a6e22e>html_entity_decode</span>(<span style=color:#a6e22e>$product</span>[<span style=color:#e6db74>&#39;name&#39;</span>], <span style=color:#a6e22e>ENT_QUOTES</span>, <span style=color:#e6db74>&#39;UTF-8&#39;</span>),
							<span style=color:#e6db74>&#39;price&#39;</span> =&gt; <span style=color:#a6e22e>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>currency</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>format</span>(<span style=color:#a6e22e>$product</span>[<span style=color:#e6db74>&#39;price&#39;</span>], <span style=color:#a6e22e>$this</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>config</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>get</span>(<span style=color:#e6db74>&#39;config_currency&#39;</span>)),
							<span style=color:#e6db74>&#39;quantity&#39;</span> =&gt; <span style=color:#a6e22e>$product</span>[<span style=color:#e6db74>&#39;quantity&#39;</span>],
							<span style=color:#e6db74>&#39;product_id&#39;</span> =&gt; <span style=color:#a6e22e>$product</span>[<span style=color:#e6db74>&#39;product_id&#39;</span>]
						);
					}
				}	
				<span style=color:#a6e22e>$data</span>[<span style=color:#e6db74>&#39;feeded&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>$my_feeds</span>;
			]]<span style=color:#f92672>&gt;&lt;</span><span style=color:#960050;background-color:#1e0010>/add&gt;</span>
		<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/operation&gt;</span>
	<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/file&gt;</span>
</code></pre></div><p>Наступним кроком зібрані дані необхідно віддати на сторінці Дякую.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript>	<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>file</span> <span style=color:#a6e22e>path</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;catalog/view/theme/*/template/common/success.twig&#34;</span><span style=color:#f92672>&gt;</span>
		<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>operation</span><span style=color:#f92672>&gt;</span>
			<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>search</span> <span style=color:#a6e22e>trim</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;true&#34;</span> <span style=color:#f92672>&gt;&lt;!</span>[<span style=color:#a6e22e>CDATA</span>[{{ <span style=color:#a6e22e>header</span> }}]]<span style=color:#f92672>&gt;&lt;</span><span style=color:#960050;background-color:#1e0010>/search&gt;</span>
			<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>add</span> <span style=color:#a6e22e>position</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;after&#34;</span><span style=color:#f92672>&gt;&lt;!</span>[<span style=color:#a6e22e>CDATA</span>[	
		<span style=color:#75715e>&lt;!--</span> <span style=color:#a6e22e>Event</span> <span style=color:#a6e22e>enhanced</span> <span style=color:#a6e22e>ecommerce</span> <span style=color:#f92672>--&gt;</span>
		<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span><span style=color:#f92672>&gt;</span>
		<span style=color:#a6e22e>setTimeout</span>(<span style=color:#66d9ef>function</span>(){ 
		  <span style=color:#a6e22e>gtag</span>(<span style=color:#e6db74>&#39;event&#39;</span>, <span style=color:#e6db74>&#39;purchase&#39;</span>, {
			<span style=color:#e6db74>&#34;transaction_id&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;{{ order_id }}&#34;</span>,
			<span style=color:#e6db74>&#34;value&#34;</span><span style=color:#f92672>:</span> {{ <span style=color:#a6e22e>total</span> }},
			<span style=color:#e6db74>&#34;currency&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;UAH&#34;</span>,
			<span style=color:#e6db74>&#34;items&#34;</span><span style=color:#f92672>:</span> [
			{<span style=color:#f92672>%</span> <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>key</span>, <span style=color:#a6e22e>item</span> <span style=color:#66d9ef>in</span> <span style=color:#a6e22e>feeded</span> <span style=color:#f92672>%</span>}
			  {
				<span style=color:#e6db74>&#34;id&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;{{ item.product_id }}&#34;</span>,
				<span style=color:#e6db74>&#34;name&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;{{ item.name }}&#34;</span>,
				<span style=color:#e6db74>&#34;quantity&#34;</span><span style=color:#f92672>:</span> {{ <span style=color:#a6e22e>item</span>.<span style=color:#a6e22e>quantity</span> }},
				<span style=color:#e6db74>&#34;price&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#39;{{ item.price }}&#39;</span>
			  }{<span style=color:#f92672>%</span> <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>key</span> <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>feeded</span><span style=color:#f92672>|</span><span style=color:#a6e22e>length</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>) <span style=color:#f92672>%</span>},{<span style=color:#f92672>%</span> <span style=color:#a6e22e>endif</span> <span style=color:#f92672>%</span>}
			  {<span style=color:#f92672>%</span> <span style=color:#a6e22e>endfor</span> <span style=color:#f92672>%</span>}
			]
		  });
		}, <span style=color:#ae81ff>3000</span>);
		<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/script&gt;</span>

		]]<span style=color:#f92672>&gt;&lt;</span><span style=color:#960050;background-color:#1e0010>/add&gt;</span>
		<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/operation&gt;</span>
	<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/file&gt;</span>
</code></pre></div><p>Ви маєто повне право спитати, а якого біса там робить функція setTimeout, слушне питання. Справа в тому, що мій сервер так швидко формував сторінку success, що не встигала провантажитися Гугл Аналітика і мені довелось додати затримку перед тим як віддати дані. Щоб перевірити, які теги завантажуються, вам необхідно встановити додаток Tag Assistant до Chrome, увімкнути його.</p><p><img src=/images/blog/tag_assistant.jpg alt="Tag Assistant enable" class="img-fluid w-100 mb-4"></p><p>Потім необхідно зробити тестове замовлення і перевірити через додаток які теги завантазуються і які дані відправляються в аналітику.</p><p><img src=/images/blog/tag_assistant2.jpg alt="Tag Assistant with tags" class="img-fluid w-100 mb-4"></p></div></article></div></div></div></section><section class="py-4 bg-gradient position-relative"><img src=/images/cta-overlay.png class="img-fluid overlay-image" alt="Пакети просування бізнесу"><div class=container><div class=row><div class="col-lg-8 col-md-7"><h2 class=text-white>Пакети просування бізнесу</h2><p class=text-white>Виберіть послугу, з якої ми почнемо комплексне просування вашого бізнесу</p><a href=/products/ class="btn btn-light">Всі послуги</a></div><div class="col-lg-4 col-md-5 position-relative"><img class=cta-image src=/images/cta.png alt="Пакети просування бізнесу"></div></div></div></section><footer class="section pb-0"><div class=container><div class="row border-bottom pb-5 justify-content-between"><div class="col-12 text-center section-sm"><a href=/><img src=/images/logo.png class=img-fluid alt="SEO просування сайту | Розкрутка сайтів в Україні"></a></div><div class="col-md-3 col-sm-6"><h5 class="font-weight-medium mb-4">Важливі посилання</h5><ul class=list-unstyled><li class=mb-3><a class=text-color href=/products/>Послуги</a></li><li class=mb-3><a class=text-color href=/blog/>Блог</a></li><li class=mb-3><a class=text-color href=/faq/>FAQ</a></li><li class=mb-3><a class=text-color href=/contact/>Контакти</a></li></ul></div><div class="col-md-4 col-sm-6"><h5 class="font-weight-medium mb-4">Зв'яжіться з нами</h5><ul class="list-unstyled mb-5"><li class=mb-3><a class=text-color href=tel:+38%28050%29381-82-70><i class="ti-mobile text-primary mr-2"></i>+38(050)381-82-70</a></li><li class=mb-3><a class=text-color href=mailto:info@seosvit.com.ua><i class="ti-email text-primary mr-2"></i>info@seosvit.com.ua</a></li><li class=mb-3><i class="ti-location-pin text-primary mr-2"></i>Kyiv, Ukraine</li></ul><ul class=list-inline><li class=list-inline-item><a href=#><i class="ti-facebook text-primary"></i></a></li><li class=list-inline-item><a href=https://twitter.com/seosvit><i class="ti-twitter-alt text-primary"></i></a></li><li class=list-inline-item><a href=#><i class="ti-youtube text-primary"></i></a></li><li class=list-inline-item><a href=#><i class="ti-instagram text-primary"></i></a></li><li class=list-inline-item><a href=#><i class="ti-pinterest text-primary"></i></a></li></ul></div><div class="col-lg-4 col-md-5"><h5 class="font-weight-medium mb-4">Форма зв'язку</h5><form action=https://formspree.io/f/mrgjgkva method=post><input type=text class="form-control mb-2" id=name name=name placeholder="Ваше ім'я">
<input type=email class="form-control mb-2" id=email name=email placeholder="Your Email">
<textarea name=message id=message class="form-control mb-2" placeholder=Повідомлення></textarea>
<button type=submit value=send class="btn btn-block btn-outline-primary rounded">Надіслати</button></form></div></div><div class=row><div class="col-12 text-center py-4">SEO студія | Copyright © 2022 All Rights Reserved |</div></div></div></footer><div id=snipcart data-api-key=M2E5YjA3NjMtYzRiYS00YzVjLWEyYWYtNDY5ZDI0OWZhYjg5 hidden></div><script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcABaamniA6OL5YvYSpB3pFMNrXwXnLwU&libraries=places"></script><script src=/plugins/jQuery/jquery.min.js></script><script src=/plugins/bootstrap/bootstrap.min.js></script><script src=/plugins/slick/slick.min.js></script><script src=/plugins/google-map/gmap.js></script><script src=/js/script.min.js></script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-215041243-1','auto');ga('send','pageview');</script><script>(function(d,t,e,m){window.RW_Async_Init=function(){RW.init({huid:"444334",uid:"811cf0927332bf51f2e12f84608594ac",source:"website",options:{"size":"medium","style":"oxygen","isDummy":false}});RW.render();};var rw,s=d.getElementsByTagName(e)[0],id="rw-js",l=d.location,ck="Y"+t.getFullYear()+
"M"+t.getMonth()+"D"+t.getDate(),p=l.protocol,f=((l.search.indexOf("DBG=")>-1)?"":".min"),a=("https:"==p?"secure."+m+"js/":"js."+m);if(d.getElementById(id))return;rw=d.createElement(e);rw.id=id;rw.async=true;rw.type="text/javascript";rw.src=p+"//"+a+"external"+f+".js?ck="+ck;s.parentNode.insertBefore(rw,s);}(document,new Date(),"script","rating-widget.com/"));</script></body></html>